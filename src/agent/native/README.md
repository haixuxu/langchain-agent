# åŸç”Ÿ Agent å®ç°

è¿™æ˜¯ä¸€ä¸ªä¸ä½¿ç”¨ LangChain çš„åŸç”Ÿ Agent å®ç°ï¼Œç›´æ¥ä½¿ç”¨ OpenAI API å’Œ Model Context Protocol (MCP) å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… ç›´æ¥ä½¿ç”¨ OpenAI APIï¼Œä¸ä¾èµ– LangChain
- âœ… æ”¯æŒ MCP å·¥å…·è‡ªåŠ¨å‘ç°å’ŒåŠ è½½
- âœ… å·¥å…·è°ƒç”¨å¾ªç¯ï¼ˆTool Calling Loopï¼‰
- âœ… æµå¼è¾“å‡ºæ”¯æŒ
- âœ… ä¸ç°æœ‰ LangChain Agent åŠŸèƒ½å…¼å®¹

## ä½¿ç”¨æ–¹æ³•

### è¿è¡ŒåŸç”Ÿ Agent

```bash
# å¼€å‘æ¨¡å¼ï¼ˆä½¿ç”¨ tsxï¼‰
npm run native

# ç¼–è¯‘åè¿è¡Œ
npm run native:build
```

### ä¸ LangChain Agent å¯¹æ¯”

**LangChain Agent:**
```bash
npm run dev
```

**åŸç”Ÿ Agent:**
```bash
npm run native
```

ä¸¤è€…ä½¿ç”¨ç›¸åŒçš„é…ç½®æ–‡ä»¶ï¼ˆ`mcp_settings.json`ï¼‰å’Œç¯å¢ƒå˜é‡ï¼ˆ`.env`ï¼‰ï¼ŒåŠŸèƒ½å®Œå…¨å…¼å®¹ã€‚

## å®ç°ç»†èŠ‚

### æ¶æ„

```
src/agent/native/
â”œâ”€â”€ index.ts              # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ agent-factory.ts      # Agent åˆ›å»ºå·¥å‚
â”œâ”€â”€ native-agent.ts       # æ ¸å¿ƒ Agent å®ç°
â”œâ”€â”€ tool-converter.ts     # MCP å·¥å…·è½¬æ¢å™¨
â””â”€â”€ repl.ts               # REPL äº¤äº’ç•Œé¢
```

### æ ¸å¿ƒç»„ä»¶

1. **NativeAgent** (`native-agent.ts`)
   - å®ç°å·¥å…·è°ƒç”¨å¾ªç¯
   - å¤„ç† OpenAI API è°ƒç”¨
   - æ”¯æŒæµå¼å’Œéæµå¼è¾“å‡º

2. **Tool Converter** (`tool-converter.ts`)
   - å°† MCP å·¥å…·è½¬æ¢ä¸º OpenAI Function æ ¼å¼
   - å¤„ç†å·¥å…·å‚æ•° schema è½¬æ¢

3. **Agent Factory** (`agent-factory.ts`)
   - åˆå§‹åŒ– MCP å®¢æˆ·ç«¯
   - åŠ è½½å’Œè½¬æ¢å·¥å…·
   - åˆ›å»º NativeAgent å®ä¾‹

### å·¥å…·è°ƒç”¨æµç¨‹

1. ç”¨æˆ·è¾“å…¥ â†’ æ·»åŠ åˆ°æ¶ˆæ¯å†å²
2. è°ƒç”¨ OpenAI APIï¼ˆæºå¸¦å·¥å…·å®šä¹‰ï¼‰
3. æ£€æŸ¥å“åº”ä¸­çš„ `tool_calls`
4. å¦‚æœæœ‰å·¥å…·è°ƒç”¨ï¼š
   - æ‰§è¡Œæ‰€æœ‰å·¥å…·è°ƒç”¨
   - å°†å·¥å…·ç»“æœæ·»åŠ åˆ°æ¶ˆæ¯å†å²
   - é‡å¤æ­¥éª¤ 2-4
5. å¦‚æœæ²¡æœ‰å·¥å…·è°ƒç”¨ï¼š
   - è¿”å›æœ€ç»ˆå“åº”

### ä¸ LangChain çš„ä¸»è¦åŒºåˆ«

| ç‰¹æ€§ | LangChain Agent | åŸç”Ÿ Agent |
|------|----------------|-----------|
| ä¾èµ– | langchain, @langchain/openai | openai |
| ä»£ç é‡ | è¾ƒå¤§ï¼ˆæ¡†æ¶æŠ½è±¡ï¼‰ | è¾ƒå°ï¼ˆç›´æ¥å®ç°ï¼‰ |
| æ€§èƒ½ | æ¡†æ¶å¼€é”€ | ç›´æ¥è°ƒç”¨ï¼Œæ€§èƒ½æ›´å¥½ |
| çµæ´»æ€§ | å—é™äºæ¡†æ¶ | å®Œå…¨å¯æ§ |
| ç»´æŠ¤æ€§ | ä¾èµ–æ¡†æ¶æ›´æ–° | è‡ªä¸»ç»´æŠ¤ |

## é…ç½®

åŸç”Ÿ Agent ä½¿ç”¨ä¸ LangChain Agent ç›¸åŒçš„é…ç½®ï¼š

- `mcp_settings.json` - MCP æœåŠ¡å™¨é…ç½®
- `.env` - ç¯å¢ƒå˜é‡ï¼ˆOPENAI_API_KEY ç­‰ï¼‰

## ç¤ºä¾‹

```bash
# å¯åŠ¨åŸç”Ÿ Agent
npm run native

# åœ¨ REPL ä¸­
ğŸ¤– > è®¡ç®— 3 + 5 ä¹˜ä»¥ 12

ğŸ¤” æ€è€ƒä¸­...

ğŸ”§ è°ƒç”¨å·¥å…·:
  - math-server_add
    å‚æ•°: { "a": 3, "b": 5 }

ğŸ“Š å·¥å…·ç»“æœ:
8

ğŸ”§ è°ƒç”¨å·¥å…·:
  - math-server_multiply
    å‚æ•°: { "a": 8, "b": 12 }

ğŸ“Š å·¥å…·ç»“æœ:
96

ç»“æœæ˜¯ 96ã€‚
```

## å¼€å‘

åŸç”Ÿ Agent æ˜¯çº¯ TypeScript å®ç°ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ä»£ç æ¥è‡ªå®šä¹‰è¡Œä¸ºï¼š

- ä¿®æ”¹ `native-agent.ts` æ¥è°ƒæ•´ Agent é€»è¾‘
- ä¿®æ”¹ `tool-converter.ts` æ¥æ”¹å˜å·¥å…·è½¬æ¢æ–¹å¼
- ä¿®æ”¹ `repl.ts` æ¥å®šåˆ¶äº¤äº’ç•Œé¢

